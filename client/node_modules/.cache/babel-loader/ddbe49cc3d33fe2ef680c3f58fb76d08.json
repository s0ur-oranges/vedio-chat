{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Jahanvi Chaudhary/Desktop/webRTC-advanced/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Jahanvi Chaudhary/Desktop/webRTC-advanced/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Jahanvi Chaudhary/Desktop/webRTC-advanced/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{setShowOverlay,setMessages}from\"../store/actions\";import store from\"../store/store\";import*as wss from\"./wss\";import Peer from\"simple-peer\";import{fetchTURNCredentials,getTurnIceServers}from\"./turn\";var defaultConstraints={audio:true,video:{width:\"480\",height:\"360\"}};var onlyAudioConstraints={audio:true,video:false};var localStream;export var getLocalPreviewAndInitRoomConnection=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(isRoomHost,identity){var roomId,onlyAudio,constraints,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:roomId=_args.length>2&&_args[2]!==undefined?_args[2]:null;onlyAudio=_args.length>3?_args[3]:undefined;_context.next=4;return fetchTURNCredentials();case 4:constraints=onlyAudio?onlyAudioConstraints:defaultConstraints;navigator.mediaDevices.getUserMedia(constraints).then(function(stream){console.log(\"successfuly received local stream\");localStream=stream;showLocalVideoPreview(localStream);// dispatch an action to hide overlay\nstore.dispatch(setShowOverlay(false));isRoomHost?wss.createNewRoom(identity,onlyAudio):wss.joinRoom(identity,roomId,onlyAudio);}).catch(function(err){console.log(\"error occurred when trying to get an access to local stream\");console.log(err);});case 6:case\"end\":return _context.stop();}}},_callee);}));return function getLocalPreviewAndInitRoomConnection(_x,_x2){return _ref.apply(this,arguments);};}();var peers={};var streams=[];var getConfiguration=function getConfiguration(){var turnIceServers=getTurnIceServers();if(turnIceServers){return{iceServers:[{urls:\"stun:stun.l.google.com:19302\"}].concat(_toConsumableArray(turnIceServers))};}else{console.warn(\"Using only STUN server\");return{iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]};}};var messengerChannel=\"messenger\";export var prepareNewPeerConnection=function prepareNewPeerConnection(connUserSocketId,isInitiator){var configuration=getConfiguration();peers[connUserSocketId]=new Peer({initiator:isInitiator,config:configuration,stream:localStream,channelName:messengerChannel});peers[connUserSocketId].on(\"signal\",function(data){// webRTC offer, webRTC Answer (SDP informations), ice candidates\nvar signalData={signal:data,connUserSocketId:connUserSocketId};wss.signalPeerData(signalData);});peers[connUserSocketId].on(\"stream\",function(stream){console.log(\"new stream came\");addStream(stream,connUserSocketId);streams=[].concat(_toConsumableArray(streams),[stream]);});peers[connUserSocketId].on(\"data\",function(data){var messageData=JSON.parse(data);appendNewMessage(messageData);});};export var handleSignalingData=function handleSignalingData(data){//add signaling data to peer connection\npeers[data.connUserSocketId].signal(data.signal);};export var removePeerConnection=function removePeerConnection(data){var socketId=data.socketId;var videoContainer=document.getElementById(socketId);var videoEl=document.getElementById(\"\".concat(socketId,\"-video\"));if(videoContainer&&videoEl){var tracks=videoEl.srcObject.getTracks();tracks.forEach(function(t){return t.stop();});videoEl.srcObject=null;videoContainer.removeChild(videoEl);videoContainer.parentNode.removeChild(videoContainer);if(peers[socketId]){peers[socketId].destroy();}delete peers[socketId];}};////////////////////////////////// UI Videos //////////////////////////////////\nvar showLocalVideoPreview=function showLocalVideoPreview(stream){var videosContainer=document.getElementById(\"videos_portal\");videosContainer.classList.add(\"videos_portal_styles\");var videoContainer=document.createElement(\"div\");videoContainer.classList.add(\"video_track_container\");var videoElement=document.createElement(\"video\");videoElement.autoplay=true;videoElement.muted=true;videoElement.srcObject=stream;videoElement.onloadedmetadata=function(){videoElement.play();};videoContainer.appendChild(videoElement);if(store.getState().connectOnlyWithAudio){videoContainer.appendChild(getAudioOnlyLabel());}videosContainer.appendChild(videoContainer);};var addStream=function addStream(stream,connUserSocketId){//display incoming stream\nvar videosContainer=document.getElementById(\"videos_portal\");var videoContainer=document.createElement(\"div\");videoContainer.id=connUserSocketId;videoContainer.classList.add(\"video_track_container\");var videoElement=document.createElement(\"video\");videoElement.autoplay=true;videoElement.srcObject=stream;videoElement.id=\"\".concat(connUserSocketId,\"-video\");videoElement.onloadedmetadata=function(){videoElement.play();};videoElement.addEventListener(\"click\",function(){if(videoElement.classList.contains(\"full_screen\")){videoElement.classList.remove(\"full_screen\");}else{videoElement.classList.add(\"full_screen\");}});videoContainer.appendChild(videoElement);// check if other user connected only with audio\nvar participants=store.getState().participants;var participant=participants.find(function(p){return p.socketId===connUserSocketId;});console.log(participant);if(participant!==null&&participant!==void 0&&participant.onlyAudio){videoContainer.appendChild(getAudioOnlyLabel(participant.identity));}else{videoContainer.style.position=\"static\";}videosContainer.appendChild(videoContainer);};var getAudioOnlyLabel=function getAudioOnlyLabel(){var identity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";var labelContainer=document.createElement(\"div\");labelContainer.classList.add(\"label_only_audio_container\");var label=document.createElement(\"p\");label.classList.add(\"label_only_audio_text\");label.innerHTML=\"Only audio \".concat(identity);labelContainer.appendChild(label);return labelContainer;};////////////////////////////////// Buttons logic //////////////////////////////////\nexport var toggleMic=function toggleMic(isMuted){localStream.getAudioTracks()[0].enabled=isMuted?true:false;};export var toggleCamera=function toggleCamera(isDisabled){localStream.getVideoTracks()[0].enabled=isDisabled?true:false;};export var toggleScreenShare=function toggleScreenShare(isScreenSharingActive){var screenSharingStream=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(isScreenSharingActive){switchVideoTracks(localStream);}else{switchVideoTracks(screenSharingStream);}};var switchVideoTracks=function switchVideoTracks(stream){for(var socket_id in peers){for(var index in peers[socket_id].streams[0].getTracks()){for(var index2 in stream.getTracks()){if(peers[socket_id].streams[0].getTracks()[index].kind===stream.getTracks()[index2].kind){peers[socket_id].replaceTrack(peers[socket_id].streams[0].getTracks()[index],stream.getTracks()[index2],peers[socket_id].streams[0]);break;}}}}};////////////////////////////////// Messages /////////////////////////////////////\nvar appendNewMessage=function appendNewMessage(messageData){var messages=store.getState().messages;store.dispatch(setMessages([].concat(_toConsumableArray(messages),[messageData])));};export var sendMessageUsingDataChannel=function sendMessageUsingDataChannel(messageContent){// append this message locally\nvar identity=store.getState().identity;var localMessageData={content:messageContent,identity:identity,messageCreatedByMe:true};appendNewMessage(localMessageData);var messageData={content:messageContent,identity:identity};var stringifiedMessageData=JSON.stringify(messageData);for(var socketId in peers){peers[socketId].send(stringifiedMessageData);}};","map":{"version":3,"names":["setShowOverlay","setMessages","store","wss","Peer","fetchTURNCredentials","getTurnIceServers","defaultConstraints","audio","video","width","height","onlyAudioConstraints","localStream","getLocalPreviewAndInitRoomConnection","isRoomHost","identity","roomId","onlyAudio","constraints","navigator","mediaDevices","getUserMedia","then","stream","console","log","showLocalVideoPreview","dispatch","createNewRoom","joinRoom","catch","err","peers","streams","getConfiguration","turnIceServers","iceServers","urls","warn","messengerChannel","prepareNewPeerConnection","connUserSocketId","isInitiator","configuration","initiator","config","channelName","on","data","signalData","signal","signalPeerData","addStream","messageData","JSON","parse","appendNewMessage","handleSignalingData","removePeerConnection","socketId","videoContainer","document","getElementById","videoEl","tracks","srcObject","getTracks","forEach","t","stop","removeChild","parentNode","destroy","videosContainer","classList","add","createElement","videoElement","autoplay","muted","onloadedmetadata","play","appendChild","getState","connectOnlyWithAudio","getAudioOnlyLabel","id","addEventListener","contains","remove","participants","participant","find","p","style","position","labelContainer","label","innerHTML","toggleMic","isMuted","getAudioTracks","enabled","toggleCamera","isDisabled","getVideoTracks","toggleScreenShare","isScreenSharingActive","screenSharingStream","switchVideoTracks","socket_id","index","index2","kind","replaceTrack","messages","sendMessageUsingDataChannel","messageContent","localMessageData","content","messageCreatedByMe","stringifiedMessageData","stringify","send"],"sources":["C:/Users/Jahanvi Chaudhary/Desktop/webRTC-advanced/client/src/utils/webRTCHandler.js"],"sourcesContent":["import { setShowOverlay, setMessages } from \"../store/actions\";\r\nimport store from \"../store/store\";\r\nimport * as wss from \"./wss\";\r\nimport Peer from \"simple-peer\";\r\nimport { fetchTURNCredentials, getTurnIceServers } from \"./turn\";\r\n\r\nconst defaultConstraints = {\r\n  audio: true,\r\n  video: {\r\n    width: \"480\",\r\n    height: \"360\",\r\n  },\r\n};\r\n\r\nconst onlyAudioConstraints = {\r\n  audio: true,\r\n  video: false,\r\n};\r\n\r\nlet localStream;\r\n\r\nexport const getLocalPreviewAndInitRoomConnection = async (\r\n  isRoomHost,\r\n  identity,\r\n  roomId = null,\r\n  onlyAudio\r\n) => {\r\n  await fetchTURNCredentials();\r\n\r\n  const constraints = onlyAudio ? onlyAudioConstraints : defaultConstraints;\r\n\r\n  navigator.mediaDevices\r\n    .getUserMedia(constraints)\r\n    .then((stream) => {\r\n      console.log(\"successfuly received local stream\");\r\n      localStream = stream;\r\n      showLocalVideoPreview(localStream);\r\n\r\n      // dispatch an action to hide overlay\r\n      store.dispatch(setShowOverlay(false));\r\n\r\n      isRoomHost\r\n        ? wss.createNewRoom(identity, onlyAudio)\r\n        : wss.joinRoom(identity, roomId, onlyAudio);\r\n    })\r\n    .catch((err) => {\r\n      console.log(\r\n        \"error occurred when trying to get an access to local stream\"\r\n      );\r\n      console.log(err);\r\n    });\r\n};\r\n\r\nlet peers = {};\r\nlet streams = [];\r\n\r\nconst getConfiguration = () => {\r\n  const turnIceServers = getTurnIceServers();\r\n\r\n  if (turnIceServers) {\r\n    return {\r\n      iceServers: [\r\n        {\r\n          urls: \"stun:stun.l.google.com:19302\",\r\n        },\r\n        ...turnIceServers,\r\n      ],\r\n    };\r\n  } else {\r\n    console.warn(\"Using only STUN server\");\r\n    return {\r\n      iceServers: [\r\n        {\r\n          urls: \"stun:stun.l.google.com:19302\",\r\n        },\r\n      ],\r\n    };\r\n  }\r\n};\r\n\r\nconst messengerChannel = \"messenger\";\r\n\r\nexport const prepareNewPeerConnection = (connUserSocketId, isInitiator) => {\r\n  const configuration = getConfiguration();\r\n\r\n  peers[connUserSocketId] = new Peer({\r\n    initiator: isInitiator,\r\n    config: configuration,\r\n    stream: localStream,\r\n    channelName: messengerChannel,\r\n  });\r\n\r\n  peers[connUserSocketId].on(\"signal\", (data) => {\r\n    // webRTC offer, webRTC Answer (SDP informations), ice candidates\r\n\r\n    const signalData = {\r\n      signal: data,\r\n      connUserSocketId: connUserSocketId,\r\n    };\r\n\r\n    wss.signalPeerData(signalData);\r\n  });\r\n\r\n  peers[connUserSocketId].on(\"stream\", (stream) => {\r\n    console.log(\"new stream came\");\r\n\r\n    addStream(stream, connUserSocketId);\r\n    streams = [...streams, stream];\r\n  });\r\n\r\n  peers[connUserSocketId].on(\"data\", (data) => {\r\n    const messageData = JSON.parse(data);\r\n    appendNewMessage(messageData);\r\n  });\r\n};\r\n\r\nexport const handleSignalingData = (data) => {\r\n  //add signaling data to peer connection\r\n  peers[data.connUserSocketId].signal(data.signal);\r\n};\r\n\r\nexport const removePeerConnection = (data) => {\r\n  const { socketId } = data;\r\n  const videoContainer = document.getElementById(socketId);\r\n  const videoEl = document.getElementById(`${socketId}-video`);\r\n\r\n  if (videoContainer && videoEl) {\r\n    const tracks = videoEl.srcObject.getTracks();\r\n\r\n    tracks.forEach((t) => t.stop());\r\n\r\n    videoEl.srcObject = null;\r\n    videoContainer.removeChild(videoEl);\r\n\r\n    videoContainer.parentNode.removeChild(videoContainer);\r\n\r\n    if (peers[socketId]) {\r\n      peers[socketId].destroy();\r\n    }\r\n    delete peers[socketId];\r\n  }\r\n};\r\n\r\n////////////////////////////////// UI Videos //////////////////////////////////\r\nconst showLocalVideoPreview = (stream) => {\r\n  const videosContainer = document.getElementById(\"videos_portal\");\r\n  videosContainer.classList.add(\"videos_portal_styles\");\r\n  const videoContainer = document.createElement(\"div\");\r\n  videoContainer.classList.add(\"video_track_container\");\r\n  const videoElement = document.createElement(\"video\");\r\n  videoElement.autoplay = true;\r\n  videoElement.muted = true;\r\n  videoElement.srcObject = stream;\r\n\r\n  videoElement.onloadedmetadata = () => {\r\n    videoElement.play();\r\n  };\r\n\r\n  videoContainer.appendChild(videoElement);\r\n\r\n  if (store.getState().connectOnlyWithAudio) {\r\n    videoContainer.appendChild(getAudioOnlyLabel());\r\n  }\r\n\r\n  videosContainer.appendChild(videoContainer);\r\n};\r\n\r\nconst addStream = (stream, connUserSocketId) => {\r\n  //display incoming stream\r\n  const videosContainer = document.getElementById(\"videos_portal\");\r\n  const videoContainer = document.createElement(\"div\");\r\n  videoContainer.id = connUserSocketId;\r\n\r\n  videoContainer.classList.add(\"video_track_container\");\r\n  const videoElement = document.createElement(\"video\");\r\n  videoElement.autoplay = true;\r\n  videoElement.srcObject = stream;\r\n  videoElement.id = `${connUserSocketId}-video`;\r\n\r\n  videoElement.onloadedmetadata = () => {\r\n    videoElement.play();\r\n  };\r\n\r\n  videoElement.addEventListener(\"click\", () => {\r\n    if (videoElement.classList.contains(\"full_screen\")) {\r\n      videoElement.classList.remove(\"full_screen\");\r\n    } else {\r\n      videoElement.classList.add(\"full_screen\");\r\n    }\r\n  });\r\n\r\n  videoContainer.appendChild(videoElement);\r\n\r\n  // check if other user connected only with audio\r\n  const participants = store.getState().participants;\r\n\r\n  const participant = participants.find((p) => p.socketId === connUserSocketId);\r\n  console.log(participant);\r\n  if (participant?.onlyAudio) {\r\n    videoContainer.appendChild(getAudioOnlyLabel(participant.identity));\r\n  } else {\r\n    videoContainer.style.position = \"static\";\r\n  }\r\n\r\n  videosContainer.appendChild(videoContainer);\r\n};\r\n\r\nconst getAudioOnlyLabel = (identity = \"\") => {\r\n  const labelContainer = document.createElement(\"div\");\r\n  labelContainer.classList.add(\"label_only_audio_container\");\r\n\r\n  const label = document.createElement(\"p\");\r\n  label.classList.add(\"label_only_audio_text\");\r\n  label.innerHTML = `Only audio ${identity}`;\r\n\r\n  labelContainer.appendChild(label);\r\n  return labelContainer;\r\n};\r\n\r\n////////////////////////////////// Buttons logic //////////////////////////////////\r\n\r\nexport const toggleMic = (isMuted) => {\r\n  localStream.getAudioTracks()[0].enabled = isMuted ? true : false;\r\n};\r\n\r\nexport const toggleCamera = (isDisabled) => {\r\n  localStream.getVideoTracks()[0].enabled = isDisabled ? true : false;\r\n};\r\n\r\nexport const toggleScreenShare = (\r\n  isScreenSharingActive,\r\n  screenSharingStream = null\r\n) => {\r\n  if (isScreenSharingActive) {\r\n    switchVideoTracks(localStream);\r\n  } else {\r\n    switchVideoTracks(screenSharingStream);\r\n  }\r\n};\r\n\r\nconst switchVideoTracks = (stream) => {\r\n  for (let socket_id in peers) {\r\n    for (let index in peers[socket_id].streams[0].getTracks()) {\r\n      for (let index2 in stream.getTracks()) {\r\n        if (\r\n          peers[socket_id].streams[0].getTracks()[index].kind ===\r\n          stream.getTracks()[index2].kind\r\n        ) {\r\n          peers[socket_id].replaceTrack(\r\n            peers[socket_id].streams[0].getTracks()[index],\r\n            stream.getTracks()[index2],\r\n            peers[socket_id].streams[0]\r\n          );\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n////////////////////////////////// Messages /////////////////////////////////////\r\nconst appendNewMessage = (messageData) => {\r\n  const messages = store.getState().messages;\r\n  store.dispatch(setMessages([...messages, messageData]));\r\n};\r\n\r\nexport const sendMessageUsingDataChannel = (messageContent) => {\r\n  // append this message locally\r\n  const identity = store.getState().identity;\r\n\r\n  const localMessageData = {\r\n    content: messageContent,\r\n    identity,\r\n    messageCreatedByMe: true,\r\n  };\r\n\r\n  appendNewMessage(localMessageData);\r\n\r\n  const messageData = {\r\n    content: messageContent,\r\n    identity,\r\n  };\r\n\r\n  const stringifiedMessageData = JSON.stringify(messageData);\r\n  for (let socketId in peers) {\r\n    peers[socketId].send(stringifiedMessageData);\r\n  }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
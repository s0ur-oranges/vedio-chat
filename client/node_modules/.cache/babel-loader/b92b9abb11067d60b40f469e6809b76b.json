{"ast":null,"code":"import { setShowOverlay, setMessages } from \"../store/actions\";\nimport store from \"../store/store\";\nimport * as wss from \"./wss\";\nimport Peer from \"simple-peer\";\nimport { fetchTURNCredentials, getTurnIceServers } from \"./turn\";\nconst defaultConstraints = {\n  audio: true,\n  video: {\n    width: \"480\",\n    height: \"360\"\n  }\n};\nconst onlyAudioConstraints = {\n  audio: true,\n  video: false\n};\nlet localStream;\nexport const getLocalPreviewAndInitRoomConnection = async function (isRoomHost, identity) {\n  let roomId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  let onlyAudio = arguments.length > 3 ? arguments[3] : undefined;\n  await fetchTURNCredentials();\n  const constraints = onlyAudio ? onlyAudioConstraints : defaultConstraints;\n  navigator.mediaDevices.getUserMedia(constraints).then(stream => {\n    console.log(\"successfuly received local stream\");\n    localStream = stream;\n    showLocalVideoPreview(localStream); // dispatch an action to hide overlay\n\n    store.dispatch(setShowOverlay(false));\n    isRoomHost ? wss.createNewRoom(identity, onlyAudio) : wss.joinRoom(identity, roomId, onlyAudio);\n  }).catch(err => {\n    console.log(\"error occurred when trying to get an access to local stream\");\n    console.log(err);\n  });\n};\nlet peers = {};\nlet streams = [];\n\nconst getConfiguration = () => {\n  const turnIceServers = getTurnIceServers();\n\n  if (turnIceServers) {\n    return {\n      iceServers: [{\n        urls: \"stun:stun.l.google.com:19302\"\n      }, ...turnIceServers]\n    };\n  } else {\n    console.warn(\"Using only STUN server\");\n    return {\n      iceServers: [{\n        urls: \"stun:stun.l.google.com:19302\"\n      }]\n    };\n  }\n};\n\nconst messengerChannel = \"messenger\";\nexport const prepareNewPeerConnection = (connUserSocketId, isInitiator) => {\n  const configuration = getConfiguration();\n  peers[connUserSocketId] = new Peer({\n    initiator: isInitiator,\n    config: configuration,\n    stream: localStream,\n    channelName: messengerChannel\n  });\n  peers[connUserSocketId].on(\"signal\", data => {\n    // webRTC offer, webRTC Answer (SDP informations), ice candidates\n    const signalData = {\n      signal: data,\n      connUserSocketId: connUserSocketId\n    };\n    wss.signalPeerData(signalData);\n  });\n  peers[connUserSocketId].on(\"stream\", stream => {\n    console.log(\"new stream came\");\n    addStream(stream, connUserSocketId);\n    streams = [...streams, stream];\n  });\n  peers[connUserSocketId].on(\"data\", data => {\n    const messageData = JSON.parse(data);\n    appendNewMessage(messageData);\n  });\n};\nexport const handleSignalingData = data => {\n  //add signaling data to peer connection\n  peers[data.connUserSocketId].signal(data.signal);\n};\nexport const removePeerConnection = data => {\n  const {\n    socketId\n  } = data;\n  const videoContainer = document.getElementById(socketId);\n  const videoEl = document.getElementById(`${socketId}-video`);\n\n  if (videoContainer && videoEl) {\n    const tracks = videoEl.srcObject.getTracks();\n    tracks.forEach(t => t.stop());\n    videoEl.srcObject = null;\n    videoContainer.removeChild(videoEl);\n    videoContainer.parentNode.removeChild(videoContainer);\n\n    if (peers[socketId]) {\n      peers[socketId].destroy();\n    }\n\n    delete peers[socketId];\n  }\n}; ////////////////////////////////// UI Videos //////////////////////////////////\n\nconst showLocalVideoPreview = stream => {\n  const videosContainer = document.getElementById(\"videos_portal\");\n  videosContainer.classList.add(\"videos_portal_styles\");\n  const videoContainer = document.createElement(\"div\");\n  videoContainer.classList.add(\"video_track_container\");\n  const videoElement = document.createElement(\"video\");\n  videoElement.autoplay = true;\n  videoElement.muted = true;\n  videoElement.srcObject = stream;\n\n  videoElement.onloadedmetadata = () => {\n    videoElement.play();\n  };\n\n  videoContainer.appendChild(videoElement);\n\n  if (store.getState().connectOnlyWithAudio) {\n    videoContainer.appendChild(getAudioOnlyLabel());\n  }\n\n  videosContainer.appendChild(videoContainer);\n};\n\nconst addStream = (stream, connUserSocketId) => {\n  //display incoming stream\n  const videosContainer = document.getElementById(\"videos_portal\");\n  const videoContainer = document.createElement(\"div\");\n  videoContainer.id = connUserSocketId;\n  videoContainer.classList.add(\"video_track_container\");\n  const videoElement = document.createElement(\"video\");\n  videoElement.autoplay = true;\n  videoElement.srcObject = stream;\n  videoElement.id = `${connUserSocketId}-video`;\n\n  videoElement.onloadedmetadata = () => {\n    videoElement.play();\n  };\n\n  videoElement.addEventListener(\"click\", () => {\n    if (videoElement.classList.contains(\"full_screen\")) {\n      videoElement.classList.remove(\"full_screen\");\n    } else {\n      videoElement.classList.add(\"full_screen\");\n    }\n  });\n  videoContainer.appendChild(videoElement); // check if other user connected only with audio\n\n  const participants = store.getState().participants;\n  const participant = participants.find(p => p.socketId === connUserSocketId);\n  console.log(participant);\n\n  if (participant !== null && participant !== void 0 && participant.onlyAudio) {\n    videoContainer.appendChild(getAudioOnlyLabel(participant.identity));\n  } else {\n    videoContainer.style.position = \"static\";\n  }\n\n  videosContainer.appendChild(videoContainer);\n};\n\nconst getAudioOnlyLabel = function () {\n  let identity = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  const labelContainer = document.createElement(\"div\");\n  labelContainer.classList.add(\"label_only_audio_container\");\n  const label = document.createElement(\"p\");\n  label.classList.add(\"label_only_audio_text\");\n  label.innerHTML = `Only audio ${identity}`;\n  labelContainer.appendChild(label);\n  return labelContainer;\n}; ////////////////////////////////// Buttons logic //////////////////////////////////\n\n\nexport const toggleMic = isMuted => {\n  localStream.getAudioTracks()[0].enabled = isMuted ? true : false;\n};\nexport const toggleCamera = isDisabled => {\n  localStream.getVideoTracks()[0].enabled = isDisabled ? true : false;\n};\nexport const toggleScreenShare = function (isScreenSharingActive) {\n  let screenSharingStream = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n  if (isScreenSharingActive) {\n    switchVideoTracks(localStream);\n  } else {\n    switchVideoTracks(screenSharingStream);\n  }\n};\n\nconst switchVideoTracks = stream => {\n  for (let socket_id in peers) {\n    for (let index in peers[socket_id].streams[0].getTracks()) {\n      for (let index2 in stream.getTracks()) {\n        if (peers[socket_id].streams[0].getTracks()[index].kind === stream.getTracks()[index2].kind) {\n          peers[socket_id].replaceTrack(peers[socket_id].streams[0].getTracks()[index], stream.getTracks()[index2], peers[socket_id].streams[0]);\n          break;\n        }\n      }\n    }\n  }\n}; ////////////////////////////////// Messages /////////////////////////////////////\n\n\nconst appendNewMessage = messageData => {\n  const messages = store.getState().messages;\n  store.dispatch(setMessages([...messages, messageData]));\n};\n\nexport const sendMessageUsingDataChannel = messageContent => {\n  // append this message locally\n  const identity = store.getState().identity;\n  const localMessageData = {\n    content: messageContent,\n    identity,\n    messageCreatedByMe: true\n  };\n  appendNewMessage(localMessageData);\n  const messageData = {\n    content: messageContent,\n    identity\n  };\n  const stringifiedMessageData = JSON.stringify(messageData);\n\n  for (let socketId in peers) {\n    peers[socketId].send(stringifiedMessageData);\n  }\n};","map":{"version":3,"names":["setShowOverlay","setMessages","store","wss","Peer","fetchTURNCredentials","getTurnIceServers","defaultConstraints","audio","video","width","height","onlyAudioConstraints","localStream","getLocalPreviewAndInitRoomConnection","isRoomHost","identity","roomId","onlyAudio","constraints","navigator","mediaDevices","getUserMedia","then","stream","console","log","showLocalVideoPreview","dispatch","createNewRoom","joinRoom","catch","err","peers","streams","getConfiguration","turnIceServers","iceServers","urls","warn","messengerChannel","prepareNewPeerConnection","connUserSocketId","isInitiator","configuration","initiator","config","channelName","on","data","signalData","signal","signalPeerData","addStream","messageData","JSON","parse","appendNewMessage","handleSignalingData","removePeerConnection","socketId","videoContainer","document","getElementById","videoEl","tracks","srcObject","getTracks","forEach","t","stop","removeChild","parentNode","destroy","videosContainer","classList","add","createElement","videoElement","autoplay","muted","onloadedmetadata","play","appendChild","getState","connectOnlyWithAudio","getAudioOnlyLabel","id","addEventListener","contains","remove","participants","participant","find","p","style","position","labelContainer","label","innerHTML","toggleMic","isMuted","getAudioTracks","enabled","toggleCamera","isDisabled","getVideoTracks","toggleScreenShare","isScreenSharingActive","screenSharingStream","switchVideoTracks","socket_id","index","index2","kind","replaceTrack","messages","sendMessageUsingDataChannel","messageContent","localMessageData","content","messageCreatedByMe","stringifiedMessageData","stringify","send"],"sources":["C:/Users/Jahanvi Chaudhary/Desktop/webRTC-advanced/client/src/utils/webRTCHandler.js"],"sourcesContent":["import { setShowOverlay, setMessages } from \"../store/actions\";\r\nimport store from \"../store/store\";\r\nimport * as wss from \"./wss\";\r\nimport Peer from \"simple-peer\";\r\nimport { fetchTURNCredentials, getTurnIceServers } from \"./turn\";\r\n\r\nconst defaultConstraints = {\r\n  audio: true,\r\n  video: {\r\n    width: \"480\",\r\n    height: \"360\",\r\n  },\r\n};\r\n\r\nconst onlyAudioConstraints = {\r\n  audio: true,\r\n  video: false,\r\n};\r\n\r\nlet localStream;\r\n\r\nexport const getLocalPreviewAndInitRoomConnection = async (\r\n  isRoomHost,\r\n  identity,\r\n  roomId = null,\r\n  onlyAudio\r\n) => {\r\n  await fetchTURNCredentials();\r\n\r\n  const constraints = onlyAudio ? onlyAudioConstraints : defaultConstraints;\r\n\r\n  navigator.mediaDevices\r\n    .getUserMedia(constraints)\r\n    .then((stream) => {\r\n      console.log(\"successfuly received local stream\");\r\n      localStream = stream;\r\n      showLocalVideoPreview(localStream);\r\n\r\n      // dispatch an action to hide overlay\r\n      store.dispatch(setShowOverlay(false));\r\n\r\n      isRoomHost\r\n        ? wss.createNewRoom(identity, onlyAudio)\r\n        : wss.joinRoom(identity, roomId, onlyAudio);\r\n    })\r\n    .catch((err) => {\r\n      console.log(\r\n        \"error occurred when trying to get an access to local stream\"\r\n      );\r\n      console.log(err);\r\n    });\r\n};\r\n\r\nlet peers = {};\r\nlet streams = [];\r\n\r\nconst getConfiguration = () => {\r\n  const turnIceServers = getTurnIceServers();\r\n\r\n  if (turnIceServers) {\r\n    return {\r\n      iceServers: [\r\n        {\r\n          urls: \"stun:stun.l.google.com:19302\",\r\n        },\r\n        ...turnIceServers,\r\n      ],\r\n    };\r\n  } else {\r\n    console.warn(\"Using only STUN server\");\r\n    return {\r\n      iceServers: [\r\n        {\r\n          urls: \"stun:stun.l.google.com:19302\",\r\n        },\r\n      ],\r\n    };\r\n  }\r\n};\r\n\r\nconst messengerChannel = \"messenger\";\r\n\r\nexport const prepareNewPeerConnection = (connUserSocketId, isInitiator) => {\r\n  const configuration = getConfiguration();\r\n\r\n  peers[connUserSocketId] = new Peer({\r\n    initiator: isInitiator,\r\n    config: configuration,\r\n    stream: localStream,\r\n    channelName: messengerChannel,\r\n  });\r\n\r\n  peers[connUserSocketId].on(\"signal\", (data) => {\r\n    // webRTC offer, webRTC Answer (SDP informations), ice candidates\r\n\r\n    const signalData = {\r\n      signal: data,\r\n      connUserSocketId: connUserSocketId,\r\n    };\r\n\r\n    wss.signalPeerData(signalData);\r\n  });\r\n\r\n  peers[connUserSocketId].on(\"stream\", (stream) => {\r\n    console.log(\"new stream came\");\r\n\r\n    addStream(stream, connUserSocketId);\r\n    streams = [...streams, stream];\r\n  });\r\n\r\n  peers[connUserSocketId].on(\"data\", (data) => {\r\n    const messageData = JSON.parse(data);\r\n    appendNewMessage(messageData);\r\n  });\r\n};\r\n\r\nexport const handleSignalingData = (data) => {\r\n  //add signaling data to peer connection\r\n  peers[data.connUserSocketId].signal(data.signal);\r\n};\r\n\r\nexport const removePeerConnection = (data) => {\r\n  const { socketId } = data;\r\n  const videoContainer = document.getElementById(socketId);\r\n  const videoEl = document.getElementById(`${socketId}-video`);\r\n\r\n  if (videoContainer && videoEl) {\r\n    const tracks = videoEl.srcObject.getTracks();\r\n\r\n    tracks.forEach((t) => t.stop());\r\n\r\n    videoEl.srcObject = null;\r\n    videoContainer.removeChild(videoEl);\r\n\r\n    videoContainer.parentNode.removeChild(videoContainer);\r\n\r\n    if (peers[socketId]) {\r\n      peers[socketId].destroy();\r\n    }\r\n    delete peers[socketId];\r\n  }\r\n};\r\n\r\n////////////////////////////////// UI Videos //////////////////////////////////\r\nconst showLocalVideoPreview = (stream) => {\r\n  const videosContainer = document.getElementById(\"videos_portal\");\r\n  videosContainer.classList.add(\"videos_portal_styles\");\r\n  const videoContainer = document.createElement(\"div\");\r\n  videoContainer.classList.add(\"video_track_container\");\r\n  const videoElement = document.createElement(\"video\");\r\n  videoElement.autoplay = true;\r\n  videoElement.muted = true;\r\n  videoElement.srcObject = stream;\r\n\r\n  videoElement.onloadedmetadata = () => {\r\n    videoElement.play();\r\n  };\r\n\r\n  videoContainer.appendChild(videoElement);\r\n\r\n  if (store.getState().connectOnlyWithAudio) {\r\n    videoContainer.appendChild(getAudioOnlyLabel());\r\n  }\r\n\r\n  videosContainer.appendChild(videoContainer);\r\n};\r\n\r\nconst addStream = (stream, connUserSocketId) => {\r\n  //display incoming stream\r\n  const videosContainer = document.getElementById(\"videos_portal\");\r\n  const videoContainer = document.createElement(\"div\");\r\n  videoContainer.id = connUserSocketId;\r\n\r\n  videoContainer.classList.add(\"video_track_container\");\r\n  const videoElement = document.createElement(\"video\");\r\n  videoElement.autoplay = true;\r\n  videoElement.srcObject = stream;\r\n  videoElement.id = `${connUserSocketId}-video`;\r\n\r\n  videoElement.onloadedmetadata = () => {\r\n    videoElement.play();\r\n  };\r\n\r\n  videoElement.addEventListener(\"click\", () => {\r\n    if (videoElement.classList.contains(\"full_screen\")) {\r\n      videoElement.classList.remove(\"full_screen\");\r\n    } else {\r\n      videoElement.classList.add(\"full_screen\");\r\n    }\r\n  });\r\n\r\n  videoContainer.appendChild(videoElement);\r\n\r\n  // check if other user connected only with audio\r\n  const participants = store.getState().participants;\r\n\r\n  const participant = participants.find((p) => p.socketId === connUserSocketId);\r\n  console.log(participant);\r\n  if (participant?.onlyAudio) {\r\n    videoContainer.appendChild(getAudioOnlyLabel(participant.identity));\r\n  } else {\r\n    videoContainer.style.position = \"static\";\r\n  }\r\n\r\n  videosContainer.appendChild(videoContainer);\r\n};\r\n\r\nconst getAudioOnlyLabel = (identity = \"\") => {\r\n  const labelContainer = document.createElement(\"div\");\r\n  labelContainer.classList.add(\"label_only_audio_container\");\r\n\r\n  const label = document.createElement(\"p\");\r\n  label.classList.add(\"label_only_audio_text\");\r\n  label.innerHTML = `Only audio ${identity}`;\r\n\r\n  labelContainer.appendChild(label);\r\n  return labelContainer;\r\n};\r\n\r\n////////////////////////////////// Buttons logic //////////////////////////////////\r\n\r\nexport const toggleMic = (isMuted) => {\r\n  localStream.getAudioTracks()[0].enabled = isMuted ? true : false;\r\n};\r\n\r\nexport const toggleCamera = (isDisabled) => {\r\n  localStream.getVideoTracks()[0].enabled = isDisabled ? true : false;\r\n};\r\n\r\nexport const toggleScreenShare = (\r\n  isScreenSharingActive,\r\n  screenSharingStream = null\r\n) => {\r\n  if (isScreenSharingActive) {\r\n    switchVideoTracks(localStream);\r\n  } else {\r\n    switchVideoTracks(screenSharingStream);\r\n  }\r\n};\r\n\r\nconst switchVideoTracks = (stream) => {\r\n  for (let socket_id in peers) {\r\n    for (let index in peers[socket_id].streams[0].getTracks()) {\r\n      for (let index2 in stream.getTracks()) {\r\n        if (\r\n          peers[socket_id].streams[0].getTracks()[index].kind ===\r\n          stream.getTracks()[index2].kind\r\n        ) {\r\n          peers[socket_id].replaceTrack(\r\n            peers[socket_id].streams[0].getTracks()[index],\r\n            stream.getTracks()[index2],\r\n            peers[socket_id].streams[0]\r\n          );\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n////////////////////////////////// Messages /////////////////////////////////////\r\nconst appendNewMessage = (messageData) => {\r\n  const messages = store.getState().messages;\r\n  store.dispatch(setMessages([...messages, messageData]));\r\n};\r\n\r\nexport const sendMessageUsingDataChannel = (messageContent) => {\r\n  // append this message locally\r\n  const identity = store.getState().identity;\r\n\r\n  const localMessageData = {\r\n    content: messageContent,\r\n    identity,\r\n    messageCreatedByMe: true,\r\n  };\r\n\r\n  appendNewMessage(localMessageData);\r\n\r\n  const messageData = {\r\n    content: messageContent,\r\n    identity,\r\n  };\r\n\r\n  const stringifiedMessageData = JSON.stringify(messageData);\r\n  for (let socketId in peers) {\r\n    peers[socketId].send(stringifiedMessageData);\r\n  }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}